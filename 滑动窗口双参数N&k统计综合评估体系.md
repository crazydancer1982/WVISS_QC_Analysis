# ğŸ“ˆ æ»‘åŠ¨çª—å£åŒå‚æ•° $(N, k)$ ç»Ÿè®¡ä¼˜åŒ–è¯„ä¼°ä½“ç³» (Markdown æºä»£ç )
  æ»‘åŠ¨çª—å£åŒå‚æ•°N&kç»Ÿè®¡ç»¼åˆè¯„ä¼°ä½“ç³»
## 1. æ ¸å¿ƒè¯„ä¼°æŒ‡æ ‡çš„è¯¦ç»†å®šä¹‰ä¸è®¡ç®—

è®¾ $Y = \{Y_1, Y_2, \dots, Y_L\}$ ä¸ºæ€»é•¿åº¦ä¸º $L$ çš„åŸå§‹æ—¶é—´åºåˆ—ã€‚æˆ‘ä»¬çº¦å®šé‡‡ç”¨**å› æœå¼æ»‘åŠ¨ä¸­ä½æ•°ï¼ˆTrailing Moving Medianï¼‰**ä½œä¸ºè¶‹åŠ¿æ‹Ÿåˆæ¨¡å‹ï¼Œå› ä¸ºå®ƒå…·æœ‰å¯¹å¼‚å¸¸å€¼ï¼ˆOutlierï¼‰çš„**é²æ£’æ€§**ï¼Œè¿™ä¸æ‚¨çš„ç»Ÿè®¡ç›®çš„ç›¸ä¸€è‡´ã€‚

### 1.1. è¶‹åŠ¿ä¼°è®¡å€¼ $\hat{Y}_i$ (åŠ¨æ€ CL ä¸­å¿ƒçº¿)

* **ç¬¦å·ï¼š** $\hat{Y}_i$
* **å«ä¹‰ï¼š** æ—¶é—´ç‚¹ $i$ å¤„çš„**è¶‹åŠ¿ä¼°è®¡å€¼**ï¼ˆå³åŠ¨æ€ CL çš„ä¸­å¿ƒçº¿ï¼‰ã€‚å®ƒåŸºäºå‰ $N$ ä¸ªè§‚æµ‹å€¼ï¼ˆæ»‘åŠ¨çª—å£ $\mathbf{W}_i$ï¼‰çš„ä¸­ä½æ•°è®¡ç®—ã€‚
* **è®¡ç®—èŒƒå›´ï¼š** $i \in [N, L]$ã€‚æˆ‘ä»¬ä»…å¯¹çª—å£å®Œå…¨å½¢æˆçš„ $L' = L - N + 1$ ä¸ªç‚¹è®¡ç®—ã€‚
* **è®¡ç®—å…¬å¼ï¼š**
    $$\hat{Y}_i = \text{Median}(\{Y_{i-N+1}, Y_{i-N+2}, \dots, Y_i\})$$
    * $Y_j$: æ—¶é—´åºåˆ—åœ¨ç´¢å¼• $j$ æ—¶çš„å®é™…è§‚æµ‹å€¼ã€‚
    * $\text{Median}(\cdot)$: å¯¹çª—å£ $\mathbf{W}_i = \{Y_{i-N+1}, \dots, Y_i\}$ å†…æ‰€æœ‰ $N$ ä¸ªè§‚æµ‹å€¼å–ä¸­ä½æ•°ã€‚

---

### 1.2. è¶‹åŠ¿æ‹Ÿåˆç²¾åº¦ï¼š$\text{Trend\_MAD}$

* **æŒ‡æ ‡åç§°ï¼š** è¶‹åŠ¿æ‹Ÿåˆçš„ä¸­ä½æ•°ç»å¯¹åå·®ï¼ˆTrend Median Absolute Deviation, $\text{Trend\_MAD}$ï¼‰ã€‚
* **ç»Ÿè®¡æ„ä¹‰ï¼š** è¡¡é‡æ»‘åŠ¨ä¸­ä½æ•°è¶‹åŠ¿çº¿å¯¹æ•°æ®çš„**æ€»ä½“æ‹Ÿåˆç¨‹åº¦**ã€‚é‡‡ç”¨ä¸­ä½æ•° (Median) ç¡®ä¿å¯¹æ®‹å·®åºåˆ—ä¸­æç«¯åå·®ï¼ˆOutliersï¼‰çš„é²æ£’æ€§ã€‚
* **è®¡ç®—å…¬å¼ï¼š**
    $$\text{Trend\_MAD} = \text{Median}\left( \left\{ \left| Y_i - \hat{Y}_i \right| \right\}_{i=N}^{L} \right)$$
    * $\left| Y_i - \hat{Y}_i \right|$: æ—¶é—´ç‚¹ $i$ çš„**ç»å¯¹æ®‹å·®**ã€‚
    * $\text{Median}(\cdot)$: å¯¹æ‰€æœ‰ $L'$ ä¸ªç»å¯¹æ®‹å·®å–ä¸­ä½æ•°ã€‚
* **ç›®æ ‡ï¼š** **æœ€å°åŒ–**ï¼Œç¡®ä¿åŠ¨æ€ CL å‡†ç¡®è·Ÿè¸ªå®è§‚è¶‹åŠ¿ã€‚

---

### 1.3. å±€éƒ¨å¼‚å¸¸å€¼æ£€æµ‹çµæ•åº¦ï¼š$\text{Max\_Absolute\_Error}$ ($\text{MAE}$)

* **æŒ‡æ ‡åç§°ï¼š** æœ€å¤§ç»å¯¹è¯¯å·®ï¼ˆMax Absolute Error, $\text{MAE}$ï¼‰ã€‚
* **ç»Ÿè®¡æ„ä¹‰ï¼š** è¡¡é‡æ®‹å·®åºåˆ—çš„**æœ€å¤§å€¼**ï¼Œä»£è¡¨äº†æœ€æç«¯åå·®çš„å¤§å°ï¼Œæ˜¯è¡¡é‡å±€éƒ¨æ³¢åŠ¨å’Œæ½œåœ¨å¼‚å¸¸å€¼æ®‹å·®çš„ä¸Šé™ã€‚
* **è®¡ç®—å…¬å¼ï¼š**
    $$\text{Max\_Absolute\_Error} = \max_{i \in [N, L]} \left( \left| Y_i - \hat{Y}_i \right| \right)$$
    * $\max_{i \in [N, L]}(\cdot)$: åœ¨ $i=N$ åˆ° $L$ çš„æ‰€æœ‰ $L'$ ä¸ªç»å¯¹æ®‹å·®ä¸­å–æœ€å¤§å€¼ã€‚
* **ç›®æ ‡ï¼š** å¯»æ‰¾ä¸€ä¸ªç»„åˆï¼Œä½¿å¾— **$\text{MAE}$ ä¿æŒåœ¨èƒ½æœ‰æ•ˆåŒºåˆ†**ç»Ÿè®¡æ³¢åŠ¨å’ŒçœŸå®å¼‚å¸¸å€¼çš„**é€‚å½“èŒƒå›´**ã€‚

---

## 2. $N$ å’Œ $k$ å…±å˜çš„äºŒç»´ç½‘æ ¼æœç´¢è®¡ç®—æ¡†æ¶

### 2.1. ä¼˜åŒ–ç›®æ ‡ã€çº¦æŸä¸ç»¼åˆæŒ‡æ ‡

* **ä¼˜åŒ–ç›®æ ‡ï¼ˆObjectiveï¼‰ï¼š** æœ€å°åŒ–ç»¼åˆç»Ÿè®¡æŒ‡æ ‡ $S(N, k)$ã€‚
    $$(N^{*}, k^{*}) = \arg \min_{N, k} S(N, k)$$
* **çº¦æŸæ¡ä»¶ï¼ˆConstraintsï¼‰ï¼š** $N_{\min} \le N \le N_{\max}$ ä¸” $1 \le k \le N$ã€‚
* **å½’ä¸€åŒ–å…¬å¼ï¼š** $X$ ä»£è¡¨ $\text{Trend\_MAD}$ æˆ– $\text{MAE}$ã€‚
    $$X_{\text{norm}}(N, k) = \frac{X(N, k) - X_{\min}^{\text{total}}}{X_{\max}^{\text{total}} - X_{\min}^{\text{total}}}$$
* **ç»¼åˆæŒ‡æ ‡ $S(N, k)$ï¼š** é‡‡ç”¨åŠ æƒå¹³å‡ï¼Œæƒé‡ $w_2$ ä¾§é‡äºå¼‚å¸¸å€¼æ£€æµ‹ã€‚
    $$\mathbf{S(N, k)} = w_1 \cdot \text{Trend\_MAD}_{\text{norm}}(N, k) + w_2 \cdot \text{Max\_Absolute\_Error}_{\text{norm}}(N, k)$$

### 2.2. äºŒç»´ç½‘æ ¼æœç´¢é€»è¾‘ (ä¼ªä»£ç æ¡†æ¶)

```python
# 1. å®šä¹‰å‚æ•°ç©ºé—´ (éœ€æ ¹æ®å®é™…æ•°æ®ç¡®å®š N_list å’Œ k_list)
N_list = [...]  # N çš„ç¦»æ•£å–å€¼ (ä¾‹å¦‚ [1, 11, 21, ..., 401])
k_list = [...]  # k çš„ç¦»æ•£å–å€¼ (ä¾‹å¦‚ [1, 5, 10, ...])

# 2. åˆå§‹åŒ–ç»“æœå­˜å‚¨
Results = []

# 3. åµŒå¥—å¾ªç¯ (Grid Search)
for N in N_list:
    for k in k_list:
        # ç¡®ä¿ k <= N (çº¦æŸæ¡ä»¶)
        if k > N:
            continue

        # --- æ ¸å¿ƒè®¡ç®—æ­¥éª¤ (åŸºäºå› æœå¼æ»‘åŠ¨ä¸­ä½æ•°) ---

        # 3.1. è®¡ç®— Trend_Values (å³æ‰€æœ‰ i å¤„çš„ hat{Y}_i)
        # ä»…å¯¹ i >= N çš„ç‚¹è®¡ç®—æ»‘åŠ¨ä¸­ä½æ•°
        Trend_Values = [Median(Data[i-N:i]) for i in range(N, L+1)] # å‡è®¾ L ä¸ºæ€»é•¿åº¦

        # 3.2. è®¡ç®—æ®‹å·®åºåˆ— Residuals
        Residuals = [abs(Data[i-1] - Trend_Values[i-N]) for i in range(N, L+1)]
        
        # 3.3. è®¡ç®—æŒ‡æ ‡
        Current_Trend_MAD = Median(Residuals)
        Current_Max_AE  = Max(Residuals)
        
        # 3.4. å­˜å‚¨åŸå§‹ç»“æœ
        Results.append({
            'N': N,
            'k': k,
            'Trend_MAD': Current_Trend_MAD,
            'Max_AE': Current_Max_AE
        })

# 4. å½’ä¸€åŒ–å’Œè®¡ç®—ç»¼åˆæŒ‡æ ‡ S (åœ¨æ‰€æœ‰å¾ªç¯å®Œæˆåæ‰§è¡Œ)
# (çœç•¥å…·ä½“å®ç°ï¼Œä½†éœ€åœ¨ Results ä¸­æ‰¾åˆ°å…¨å±€ Min/Maxï¼Œç„¶åè®¡ç®— S)
# ... Calculate_Normalization_and_S(Results, w1, w2)

# 5. ç¡®å®šæœ€ä¼˜è§£
Optimal_Result = Find_Min(Results, key='S')
N_star = Optimal_Result['N']
k_star = Optimal_Result['k']

# 6. ç»“æœå¯è§†åŒ–ï¼šçƒ­åŠ›å›¾æœ€ç»ˆç»“æœåº”ä»¥çƒ­åŠ›å›¾çš„å½¢å¼å±•ç¤ºï¼Œæ¸…æ™°åœ°æ ‡ç¤ºå‡ºç»¼åˆæŒ‡æ ‡ $S$ çš„æœ€å°å€¼åŒºåŸŸã€‚

pandoc -s "æ»‘åŠ¨çª—å£åŒå‚æ•°N&kç»Ÿè®¡ç»¼åˆè¯„ä¼°ä½“ç³».md" -o "æ»‘åŠ¨çª—å£åŒå‚æ•°N&kç»Ÿè®¡ç»¼åˆè¯„ä¼°ä½“ç³».docx"

